<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ì–æ–Ω–∫–∞ –∑–∞ 50 –ø—É–Ω–∫—Ç–æ–≤</title>

<style>
body{margin:0;padding:20px;font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#fde2e4,#e0f2fe)}
h1{text-align:center}
.layout{display:flex;gap:16px;max-width:1000px;margin:0 auto}
.players{flex:1;display:flex;flex-direction:column;gap:16px}
.rules{width:300px;background:#ffffffcc;border-radius:16px;padding:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);font-size:14px}
.rules h3{text-align:center;margin-top:0}
.rule{margin-bottom:10px}
.rule ul{margin:4px 0 0 18px;padding:0}
.rule.plus b{color:#16a34a}
.rule.minus b{color:#dc2626}
.card{background:#fff;border-radius:16px;padding:12px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.row{display:flex;align-items:center;gap:12px}
.main{flex:1}
.top{display:flex;align-items:center;gap:12px}
.avatar{position:relative}
.avatar img{width:48px;height:48px;border-radius:50%;object-fit:cover}
.medals{position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);font-size:12px;white-space:nowrap}
.big-medal{font-size:20px;margin-left:6px}
.track{position:relative;background:#e5e7eb;height:22px;border-radius:12px;margin:10px 0 12px;overflow:hidden}
.vehicle{position:absolute;top:50%;transform:translate(-50%,-50%);font-size:22px;transition:left 1s ease}
.track.flash-green{box-shadow:0 0 0 3px rgba(34,197,94,.6)}
.track.flash-red{box-shadow:0 0 0 3px rgba(248,113,113,.7)}
.buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;width:110px}
button{border:none;border-radius:10px;padding:6px;font-size:14px;cursor:pointer}
.plus{background:#22c55e;color:#fff}
.minus{background:#f87171;color:#fff}
.confetti{position:fixed;top:-10px;width:8px;height:12px;opacity:.8;pointer-events:none;animation:fall linear forwards;z-index:9999}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg)}}
</style>
</head>
<body>

<h1>üèÅ –ì–æ–Ω–∫–∞ –∑–∞ 50 –ø—É–Ω–∫—Ç–æ–≤</h1>
<div style="text-align:center;margin-bottom:12px;">
  <button id="resetAll" style="background:#64748b;color:#fff;border:none;border-radius:10px;padding:6px 12px;cursor:pointer">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
</div>
<div class="layout">
  <div class="rules">
    <h3>üìã –ö–∞–∫ –ø–æ–ª—É—á–∞—Ç—å –ø—É–Ω–∫—Ç—ã</h3>

    <div class="rule plus"><b>+5</b>
      <ul>
        <li>–ü–æ—á–∏—Ç–∞—Ç—å –ë–∏–±–ª–∏—é</li>
        <li>–°–¥–µ–ª–∞—Ç—å –¥/–∑</li>
        <li>–•–æ—Ä–æ—à–æ –≤–µ—Å—Ç–∏ —Å–µ–±—è –≤ —Ü–µ—Ä–∫–≤–∏ / –Ω–∞ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏</li>
        <li>–í—ã—É—á–∏—Ç—å —Å—Ç–∏—Ö –∏–ª–∏ –ø–µ—Å–Ω—é</li>
        <li>–°–∞–º–æ–º—É –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è –≤ –æ—à–∏–±–∫–µ</li>
      </ul>
    </div>

    <div class="rule plus"><b>+3</b>
      <ul>
        <li>–°–≤–æ—è —Ä–∞–±–æ—Ç–∞ –ø–æ –¥–æ–º—É</li>
        <li>–û–±—â–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ –¥–æ–º—É</li>
        <li>–ù–∞—Å—Ç–æ–ª—å–Ω–∞—è –∏–≥—Ä–∞ –±–µ–∑ —Å—Å–æ—Ä</li>
        <li>–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Å—å–±—É —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞</li>
      </ul>
    </div>

    <div class="rule plus"><b>+1</b>
      <ul>
        <li>–°–ø–æ—Ä—Ç</li>
        <li>–†–∞—Å–∫—Ä–∞—Å–∫–∞</li>
      </ul>
    </div>

    <div class="rule minus"><b>-5</b>
      <ul>
        <li>–°–æ–≤—Ä–∞—Ç—å</li>
        <li>–£–¥–∞—Ä–∏—Ç—å</li>
        <li>–û–±–∏–¥–µ—Ç—å –±—Ä–∞—Ç–∞ / —Å–µ—Å—Ç—Ä—É</li>
        <li>–£–≥–æ–ª</li>
        <li>–ü–ª–æ—Ö–æ –≤–µ—Å—Ç–∏ —Å–µ–±—è –≤ —Ü–µ—Ä–∫–≤–∏ / –Ω–∞ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏</li>
      </ul>
    </div>

    <div class="rule minus"><b>-3</b>
      <ul>
        <li>–ù–µ —Å–¥–µ–ª–∞—Ç—å —Å–≤–æ—é —Ä–∞–±–æ—Ç—É</li>
        <li>–ù–µ —Å–¥–µ–ª–∞—Ç—å –æ–±—â—É—é —Ä–∞–±–æ—Ç—É</li>
        <li>–ü–æ—Ä—Ç–∏—Ç—å –∏–≥—Ä—É –¥—Ä—É–≥–∏–º</li>
      </ul>
    </div>

    <div class="rule minus"><b>-1</b>
      <ul>
        <li>–ü–ª–æ—Ö–æ –∫—É—à–∞—Ç—å</li>
        <li>–í–æ—Ä–æ–≤–∞—Ç—å —Å–ª–∞–¥–æ—Å—Ç–∏</li>
        <li>–õ–æ–º–∞—Ç—å –≤–µ—â–∏</li>
      </ul>
    </div>
  </div>

  <div class="players" id="players"></div>
</div>

<script>
const GOAL=50;
const STORAGE_KEY="points_race";

const defaultPlayers=[
 {id:1,name:"Luca",points:0,medals:0,avatar:"luca.png",vehicle:"üê¢",sound:"turtle.mp3"},
 {id:2,name:"Ezra",points:0,medals:0,avatar:"ezra.png",vehicle:"üöÄ",sound:"rocket.mp3"},
 {id:3,name:"Raphael",points:0,medals:0,avatar:"raphael.png",vehicle:"üêé",sound:"horse.mp3"}
];

let players=load();

function load(){
 const s=localStorage.getItem(STORAGE_KEY);
 const data=s?JSON.parse(s):JSON.parse(JSON.stringify(defaultPlayers));
 data.forEach(p=>{if(p.medals===undefined)p.medals=0;});
 return data;
}

function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(players));}

// === –ó–í–£–ö–ò ===
let clickSound=null, oopsSound=null;
try{clickSound=new Audio("click.mp3"); clickSound.volume=0.5;}catch(e){}
try{oopsSound=new Audio("oops.mp3"); oopsSound.volume=0.6;}catch(e){}

function play(sound){if(!sound)return;try{sound.currentTime=0;sound.play();}catch(e){}}

function playTransportSound(player){
 try{const s=new Audio(player.sound);s.volume=0.7;s.play();}catch(e){}
}

function changePoints(id,delta){
 const p=players.find(x=>x.id===id);
 if(!p) return;
 const old=p.points;
 p.points+=delta;
 save();

 const diff=p.points-old;

 setTimeout(()=>{
   render();
   highlight(id,diff);

   if(diff>0){playTransportSound(p);}else{play(oopsSound);}  

   checkWinner();
 },650);
}

function highlight(id,diff){
 const track=document.querySelector(`[data-track='${id}']`);
 if(!track) return;
 const cls=diff>=0?"flash-green":"flash-red";
 track.classList.add(cls);
 setTimeout(()=>track.classList.remove(cls),400);
}

function checkWinner(){
 const w=players.find(p=>p.points>=GOAL);
 if(!w) return;

 w.medals++;
 w.points=0;
 save();

 launchConfetti();

 setTimeout(()=>{
   alert(`üéâ ${w.name} –ø–æ–ª—É—á–∞–µ—Ç –º–µ–¥–∞–ª—å! (${w.medals}/5)`);
   render();
 },600);
}

document.getElementById("resetAll").onclick=()=>{
 if(!confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –æ—á–∫–∏ –∏ –º–µ–¥–∞–ª–∏?")) return;
 players=JSON.parse(JSON.stringify(defaultPlayers));
 save();
 render();
};

function render(){
 const root=document.getElementById("players");
 root.innerHTML="";

 players.forEach(p=>{
  const progress=Math.max(0,Math.min(p.points/GOAL,1))*100;
  const smallMedals="ü•á".repeat(Math.min(p.medals,4));
  const bigMedal = p.medals>=5 ? "<span class='big-medal'>üèÜ</span>" : "";

  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
   <div class="row">
    <div class="main">
      <div class="top">
        <div class="avatar">
          <img src="${p.avatar}">
          <div class="medals">${smallMedals}</div>
        </div>
        <div><b>${p.name}</b>${bigMedal}<br>${p.points}</div>
      </div>
      <div class="track" data-track="${p.id}">
        <div class="vehicle" style="left:${progress}%">${p.vehicle}</div>
      </div>
    </div>

    <div class="buttons">
      <button class="plus" data-d="1">+1</button>
      <button class="minus" data-d="-1">‚àí1</button>
      <button class="plus" data-d="3">+3</button>
      <button class="minus" data-d="-3">‚àí3</button>
      <button class="plus" data-d="5">+5</button>
      <button class="minus" data-d="-5">‚àí5</button>
    </div>
   </div>`;

  div.querySelectorAll("button").forEach(btn=>{
    const d=parseInt(btn.dataset.d);
    btn.onclick=()=>{play(clickSound);changePoints(p.id,d);};
  });

  root.appendChild(div);
 });
}

function launchConfetti(){
 const colors=["#ff6b6b","#ffd93d","#6bcb77","#4dabf7","#c77dff"];
 for(let i=0;i<120;i++){
  const c=document.createElement("div");
  c.className="confetti";
  c.style.left=Math.random()*100+"vw";
  c.style.background=colors[Math.floor(Math.random()*colors.length)];
  c.style.animationDuration=2+Math.random()*2+"s";
  document.body.appendChild(c);
  setTimeout(()=>c.remove(),4000);
 }
}

render();
</script>
</body>
</html>
