<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ì–æ–Ω–∫–∞ –∑–∞ 50 –ø—É–Ω–∫—Ç–æ–≤</title>

<style>
body{margin:0;padding:20px;font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#fde2e4,#e0f2fe)}
h1{text-align:center}
.players{max-width:560px;margin:0 auto;display:flex;flex-direction:column;gap:16px}
.card{background:#fff;border-radius:16px;padding:12px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.row{display:flex;align-items:center;gap:12px}
.main{flex:1}
.top{display:flex;align-items:center;gap:12px}
.avatar img{width:48px;height:48px;border-radius:50%;object-fit:cover}
.track{position:relative;background:#e5e7eb;height:22px;border-radius:12px;margin:10px 0 12px;overflow:hidden}
.vehicle{position:absolute;top:50%;transform:translate(-50%,-50%);font-size:22px;transition:left .5s ease}
.track.flash-green{box-shadow:0 0 0 3px rgba(34,197,94,.6)}
.track.flash-red{box-shadow:0 0 0 3px rgba(248,113,113,.7)}
.buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;width:110px}
button{border:none;border-radius:10px;padding:6px;font-size:14px;cursor:pointer}
.plus{background:#22c55e;color:#fff}
.minus{background:#f87171;color:#fff}
.confetti{position:fixed;top:-10px;width:8px;height:12px;opacity:.8;pointer-events:none;animation:fall linear forwards;z-index:9999}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg)}}
</style>
</head>
<body>

<h1>üèÅ –ì–æ–Ω–∫–∞ –∑–∞ 50 –ø—É–Ω–∫—Ç–æ–≤</h1>
<div class="players" id="players"></div>

<script>
const GOAL=50;
const STORAGE_KEY="points_race";

const defaultPlayers=[
 {id:1,name:"Luca",points:0,avatar:"luca.png",vehicle:"üê¢"},
 {id:2,name:"Ezra",points:0,avatar:"ezra.png",vehicle:"üöÄ"},
 {id:3,name:"Raphael",points:0,avatar:"raphael.png",vehicle:"üêé"}
];

let players=load();

function load(){
 const s=localStorage.getItem(STORAGE_KEY);
 return s?JSON.parse(s):JSON.parse(JSON.stringify(defaultPlayers));
}

function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(players));}

// –ó–≤—É–∫ –∫–Ω–æ–ø–æ–∫ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
let clickSound=null;
try{clickSound=new Audio("click.mp3");clickSound.volume=0.5;}catch(e){}
function playClick(){
 if(!clickSound) return;
 try{clickSound.currentTime=0;clickSound.play();}catch(e){}
}

function changePoints(id,delta){
 const p=players.find(x=>x.id===id);
 if(!p) return;
 const old=p.points;
 p.points+=delta;
 save();
 render();
 highlight(id,p.points-old);
 checkWinner();
}

function highlight(id,diff){
 const track=document.querySelector(`[data-track='${id}']`);
 if(!track) return;
 const cls=diff>=0?"flash-green":"flash-red";
 track.classList.add(cls);
 setTimeout(()=>track.classList.remove(cls),400);
}

function checkWinner(){
 const w=players.find(p=>p.points>=GOAL);
 if(w){
  launchConfetti();
  setTimeout(()=>{alert("üéâ –ü–æ–±–µ–¥–∏—Ç–µ–ª—å: "+w.name);reset();},600);
 }
}

function reset(){
 players=JSON.parse(JSON.stringify(defaultPlayers));
 localStorage.removeItem(STORAGE_KEY);
 render();
}

function render(){
 const root=document.getElementById("players");
 root.innerHTML="";

 players.forEach(p=>{
  const progress=Math.max(0,Math.min(p.points/GOAL,1))*100;
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
   <div class="row">
    <div class="main">
      <div class="top">
        <div class="avatar"><img src="${p.avatar}"></div>
        <div><b>${p.name}</b><br>${p.points}</div>
      </div>
      <div class="track" data-track="${p.id}">
        <div class="vehicle" style="left:${progress}%">${p.vehicle}</div>
      </div>
    </div>

    <div class="buttons">
      <button class="plus" data-d="1">+1</button>
      <button class="minus" data-d="-1">‚àí1</button>
      <button class="plus" data-d="3">+3</button>
      <button class="minus" data-d="-3">‚àí3</button>
      <button class="plus" data-d="5">+5</button>
      <button class="minus" data-d="-5">‚àí5</button>
    </div>
   </div>`;

  div.querySelectorAll("button").forEach(btn=>{
    const d=parseInt(btn.dataset.d);
    btn.onclick=()=>{playClick();changePoints(p.id,d);};
  });

  root.appendChild(div);
 });
}

function launchConfetti(){
 const colors=["#ff6b6b","#ffd93d","#6bcb77","#4dabf7","#c77dff"];
 for(let i=0;i<120;i++){
  const c=document.createElement("div");
  c.className="confetti";
  c.style.left=Math.random()*100+"vw";
  c.style.background=colors[Math.floor(Math.random()*colors.length)];
  c.style.animationDuration=2+Math.random()*2+"s";
  document.body.appendChild(c);
  setTimeout(()=>c.remove(),4000);
 }
}

render();
</script>
</body>
</html>
